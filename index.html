<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <meta content="utf-8" http-equiv="encoding">
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<body>

<svg width="100%" height="200">
</svg> 
 <script>
  var minWidthPercent = 15;

  var data = [{ time: 0, complete: true },
              { time: 3, complete: true },
              { time: 5, complete: true }, 
              { time: 11, complete: false }, 
              { time: 15, complete: false }];

  var nbData = data.length;

  // 1. Prepare Data
  // Fill "width" values
  for(i=0; i<nbData - 1; i++){
    data[i].width = data[i+1].time - data[i].time;
  }
  data[nbData-1].width = 0;

  // Adjust width to have a minimum width
  var minWidth = minWidthPercent * data[nbData-1].width / 100;
  var totalMarge = 0;
  for(i=0; i < nbData-1; i++){
    if(data[i].width < minWidth){
      data[i].width = minWidth;  
      data[i+1].time = data[i].time + minWidth - data[i].width
    }
    totalMarge += minWidth - data[i].width;
  }

  var avgMarge = parseInt(totalMarge / (nbData-1));
  for(i=0; i < nbData-1; i++){
    data[i].width = data[i].width - avgMarge;
    data[i+1].time = data[i].time + data[i].width;
  }

  // Fill "color" values
  var rangeBlueColors = ["#BDCEF1", "#9EB8EB", "#80A1E4", "#628BDE", "#4374D7", "#2B60CB", "#2451AC", "#1E438E" ];
  
  var rangeRedColors = ["#FFE5E5","#FFCCCC","#FFB3B3","#FF9999","#FF8080","#FF6666","#FF4D4D","#FF3333","#FF1A1A","#FF0000","#E60000","#CC0000","#B30000","#990000","#800000","#660000"];

  nbColors = rangeBlueColors.length;
  for(i=0; i<nbData; i++){
    data[i].color = rangeBlueColors[parseInt((i+1) * nbColors / nbData)];
  }


  // 2. Draw data

  var width = parseInt(d3.select('svg').style('width'), 10);
  var margin = { left: 60, top: 60, right: 60, bottom: 60};
  var rectProps = {height: 30};
  var circleProps = {radius : 20};

  var svg = d3.select("svg");
  var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  var xScale = d3.scale.linear()
                  .domain([0, data[data.length-1].time])
                  .range([0, width - margin.right - margin.left]);

  var xAxis = d3.svg.axis()
                .orient("bottom")
                .scale(xScale);

  for(i=0; i < nbData; i++){
    console.log(data[i]);
    console.log(data[i].time);
    console.log(xScale(data[i].time));
    console.log(xScale(data[i].width));
    console.log(data[i].color);
  }

  g.selectAll("rect")
      .data(data)
      .enter().append("rect")
        .attr("x", function(d){ return xScale(d.time); })
        .attr("y", -rectProps.height / 2)
        .attr("width", function(d){ return xScale(d.width); })
        .attr("height", rectProps.height)
        .attr("fill", function(d){ return d.color; });
  
  g.selectAll("circle")
      .data(data)
      .enter().append("circle")
        .attr("cx", function(d){ return xScale(d.time); })
        .attr("cy", 0)
        .attr("r", circleProps.radius)
        .attr("fill", function(d){ return d.complete ? "green" : "lightgrey"; });

 </script>
</body>
</html>

